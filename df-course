FROM rubigdata/spark-slim
MAINTAINER Arjen P. de Vries <arjen@acm.org>

USER root:root

## SBT

RUN echo Prepare SBT \
 && $wget -O /etc/yum.repos.d/sbt-rpm.repo https://www.scala-sbt.org/sbt-rpm.repo \
 && $microdnf install sbt

USER hadoop:hadoop

## Note: the use of ADD on a local tar archive unpacks it automatically

ADD --chown=hadoop:hadoop rubigdata.tgz /opt/hadoop/

COPY stream.py /opt/hadoop/rubigdata/

## Update CMD to start the stream on startup

WORKDIR /opt/hadoop/rubigdata

CMD ["/bin/bash", "-c", ". /opt/hadoop/.bashrc ; (python3 stream.py &) ; /opt/zeppelin/bin/zeppelin.sh"]